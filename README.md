# 📄 公文格式调整工具

[![Python Version](https://img.shields.io/badge/python-3.6%2B-blue)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)

按照 **GB/T 9704-2012《党政机关公文格式》** 标准，自动调整 Word 文档格式的命令行工具。

---

## ✨ 核心功能

### 📌 自动识别与格式化
- ✅ 主标题（方正小标宋22号，居中）
- ✅ 主送机关（仿宋16号，顶格）
- ✅ 多级标题（一、二、三、/ （一）（二）/ 1. 2. 3. / (1) (2) (3)）
- ✅ 正文、署名、日期
- ✅ 表格、图片（自动识别并跳过/居中）

### 🔧 智能修正
- ✅ 自动修正标题层级跳跃
- ✅ 自动修正编号不连续
- ✅ 清除多余标点符号（如"（二）."、"（一）1、"）
- ✅ 删除标题上方多余空行
- ✅ 统一页边距和缩进

### 📎 附件处理
- ✅ 附件独立编号（从"一、"重新开始）
- ✅ 附件列表格式规范化（"附件：1.XXX"、"      2.XXX"）
- ✅ 附件前自动分页

---

## 🚀 快速开始

### 1️⃣ 安装依赖

```bash
pip3 install -r requirements_simple.txt
```

### 2️⃣ 运行程序

#### 方式一：双击运行（推荐）

**macOS:**
```bash
# 首次使用赋予权限
chmod +x 一键运行.command

# 双击运行
双击 "一键运行.command" 文件
```

**Windows:**
```bash
# 双击运行
双击 "一键运行.bat" 文件
```

#### 方式二：命令行运行

```bash
python3 gongwen_formatter_cli.py
```

### 3️⃣ 使用

1. 拖拽 Word 文档到终端窗口
2. 按回车键开始处理
3. 处理完成后，文件保存在原目录，文件名前加 `done_` 前缀

---

## 📁 文件结构

```
codebuddy_gongwen/
├── gongwen_formatter_cli.py  # 主程序
├── requirements_simple.txt   # 依赖列表
├── README.md                 # 技术文档（本文件）
├── 使用说明.md               # 用户手册
├── 一键运行.command           # macOS 启动脚本
└── 一键运行.bat               # Windows 启动脚本
```

---

## 📋 格式标准

严格按照 **GB/T 9704-2012** 标准：

| 元素 | 字体 | 字号 | 对齐 | 缩进 |
|------|------|------|------|------|
| 主标题 | 方正小标宋简体 | 22号 | 居中 | 无 |
| 主送机关 | 仿宋_GB2312 | 16号 | 左 | 顶格 |
| 一级标题 | 黑体 | 16号 | 左 | 2字符 |
| 二级标题 | 楷体_GB2312 | 16号（加粗） | 左 | 2字符 |
| 三级标题 | 仿宋_GB2312 | 16号（加粗） | 左 | 2字符 |
| 四级标题 | 仿宋_GB2312 | 16号 | 左 | 2字符 |
| 正文 | 仿宋_GB2312 | 16号 | 左 | 2字符 |
| 署名/日期 | 仿宋_GB2312 | 16号 | 右 | 无 |

**页边距：** 上3.7cm、下3.5cm、左2.8cm、右2.6cm  
**行距：** 固定值30磅

---

## 🔧 技术实现

### 核心算法

#### 1. 标题识别与层级修正
```python
def validate_and_fix_heading_structure(paragraphs_list):
    """
    1. 识别所有标题及其级别
    2. 检测层级跳跃（如从一级直接跳到三级）
    3. 检测编号不连续
    4. 附件部分独立编号
    """
```

#### 2. 格式清理与统一
```python
def apply_paragraph_format(paragraph, style_name):
    """
    1. 清除前导空格/Tab
    2. 清除多余标点符号
    3. 清除多重编号（如"（一）1、"）
    4. 应用标准格式
    """
```

#### 3. 附件处理
```python
def normalize_attachment_list(paragraphs_list):
    """
    1. 识别附件列表起始
    2. 规范化编号格式
    3. 统一缩进对齐
    """
```

### 关键特性

- **循环清理机制**：处理复杂的多重编号（最多5轮清理）
- **上下文推断**：智能推断自动编号后的标题级别
- **附件独立性**：附件标记后重置所有编号计数器
- **非破坏性处理**：生成新文件，不覆盖原文件

---

## 💡 使用示例

### 示例 1：基本使用

```bash
$ python3 gongwen_formatter_cli.py

📎 请拖拽Word文档到此处（或输入q退出）: /path/to/测试文档.docx

📄 正在处理: 测试文档.docx
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ⏳ 读取文档...
  ✅ 页边距: 上3.7cm 下3.5cm 左2.8cm 右2.6cm
  🔍 开始验证标题层级结构...
  📊 检测到 12 个标题
  ✅ 标题层级结构正确
  🔍 开始规范化附件列表...
  ✅ 附件列表格式正确
  📌 标题: 关于XX的通知
  📨 主送机关: 各部门：
  🔹 一级标题: 一、指导思想
  ✓ 全部 35 个段落处理完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 处理完成！
📁 输出文件: /path/to/done_测试文档.docx
```

### 示例 2：批量处理

```bash
# 处理完第一个文档后，继续拖入第二个
📎 请拖拽Word文档到此处（或输入q退出）: /path/to/文档2.docx
# ... 处理中 ...
✅ 处理完成！

# 继续处理第三个
📎 请拖拽Word文档到此处（或输入q退出）: /path/to/文档3.docx
# ... 处理中 ...
✅ 处理完成！

# 退出
📎 请拖拽Word文档到此处（或输入q退出）: q
👋 再见！
```

---

## ⚠️ 注意事项

### 1. 系统字体
确保系统已安装以下字体：
- 方正小标宋简体
- 黑体
- 楷体_GB2312
- 仿宋_GB2312

### 2. 文件格式
- ✅ 支持：`.docx`（Word 2007+）
- ❌ 不支持：`.doc`（Word 2003）

### 3. 特殊内容
- **表格**：跳过不处理（保持原样）
- **图片**：自动居中对齐
- **手动编号**：需要是标准格式（一、/（一）/1./（1））

---

## 🐛 已知问题

目前无已知问题。如发现 bug，请反馈。

---

## 📝 更新日志

### v2.0.0 (2025-12-10)
- ✅ 修复二级标题多余点号问题（如"（二）."）
- ✅ 修复多重编号问题（如"（一）1、"）
- ✅ 实现附件独立编号
- ✅ 优化附件列表格式（首行缩进2字符）
- ✅ 清理临时文件，完善文档

### v1.7.1
- ✅ 智能修正标题层级
- ✅ 自动清理多余空行
- ✅ 附件列表格式规范化

### v1.0.0
- ✅ 基础格式调整功能

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📄 许可证

MIT License

---

## 📞 联系方式

如有问题或建议，欢迎反馈。

---

**🎉 感谢使用公文格式调整工具！**
